import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from sklearn import linear_model

df = pd.read_csv('датасет-1.csv', sep=';')

print("Первые строки датасета:")
print(df.head())

print("\nТипы данных в датасете:")
print(df.dtypes)

if df['price'].dtype == 'object':
    df['price'] = df['price'].str.replace(',', '.').astype(float)
    print("\nТип данных столбца 'price' после преобразования:", df['price'].dtype)

plt.scatter(df['area'], df['price'], color='red')
plt.xlabel('Площадь (кв.м.)')
plt.ylabel('Стоимость (млн.руб)')
plt.title('Зависимость стоимости квартиры от площади')
plt.show()

reg = linear_model.LinearRegression()

X = df['area'].values.reshape(-1, 1)
y = df['price'].values
reg.fit(X, y)

print("\nПредсказанная стоимость квартиры 38 м²:", reg.predict([[38]])[0])
print("Предсказанная стоимость квартиры 200 м²:", reg.predict([[200]])[0])

print("\nПредсказанные цены для всех площадей в датасете:")
print(reg.predict(X))

print("\nКоэффициенты модели:")
print("a (коэффициент):", reg.coef_[0])
print("b (интерсепт):", reg.intercept_)
print(f"Уравнение модели: price = {reg.coef_[0]:.4f} * area + {reg.intercept_:.4f}")

plt.scatter(df['area'], df['price'], color='red')
plt.xlabel('Площадь (кв.м.)')
plt.ylabel('Стоимость (млн.руб)')
plt.title('Линейная регрессия: зависимость стоимости от площади')
plt.plot(df['area'], reg.predict(X), color='blue')
plt.show()


try:
    pred = pd.read_csv('prediction_price.csv', sep=';')

    if 'price' in pred.columns and pred['price'].dtype == 'object':
        pred['price'] = pred['price'].str.replace(',', '.').astype(float)

    X_pred = pred['area'].values.reshape(-1, 1)
    p = reg.predict(X_pred)

    pred['predicted prices'] = p

    print("\nРезультаты предсказания для новых данных:")
    print(pred)

    pred.to_excel('new.xlsx', index=False)
    print("\nФайл с предсказаниями сохранен как 'new.xlsx'")

except FileNotFoundError:
    print("\nФайл 'prediction_price.csv' не найден. Пропускаем шаг 8.")
